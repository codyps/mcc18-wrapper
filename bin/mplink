#!/bin/sh
BASEDIR=`dirname $0`

if [ $(uname) = "CYGWIN_NT-6.0" ]; then
  WINE=""
else
  WINE=wine
fi

output=$( ${WINE} ${BASEDIR}/mplink.exe $* | egrep -v '^$' |
  egrep -v '^MPLINK 3\.90\, Linker' |
  egrep -v '^Copyright \(c\) 2004 Microchip Technology Inc\.' |
  egrep -v '^Errors    : 0' |
  egrep -v '^Warnings  : 0' )

if (echo "${output}" | grep -q 'Errors'); then
  echo "${output}"
  exit 1
else
  exit 0
fi
